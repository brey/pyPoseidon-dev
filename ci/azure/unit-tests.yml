steps:

- template: install.yml

- bash: |
    source activate pyPoseidon-tests
    python -OO -c "import pyPoseidon"
  displayName: Import pyPoseidon

- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'
  displayName: 'Use Python $(python.version)'

- script: |
    pip install pytest-azurepipelines
    pytest
  displayName: 'pytest'

# Work around for allowed test failures:
# https://github.com/microsoft/azure-pipelines-tasks/issues/9302
#- bash: |
#    source activate pyPoseidon-tests
#    pytest \
#    --junitxml=junit/test-results.xml \
#    --cov=xarray \
#    --cov-report=xml \
#    $(pytest_extra_flags) || [ "$ALLOW_FAILURE" = "true" ]
#  displayName: Run tests

